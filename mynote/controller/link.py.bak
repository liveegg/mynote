# -*- coding: utf-8 -*- 
""" 
    simulation.controller.link
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
""" 

import os
import string
import requests
from urllib import quote

from flask import render_template, request, redirect , url_for, session, current_app, jsonify 
from werkzeug import generate_password_hash 
from simulation.simulation_logger import Log 
from simulation.simulation_blueprint import simulationlog 
from simulation.database import category_dao, board_dao
from simulation.model.category import Category
from simulation.model.board import Board
from simulation.model.link import Link
from simulation.model.simprod_link import SimprodLink
from collections import defaultdict
from sqlalchemy import or_
from sqlalchemy.sql import text
from urlparse import urlparse

@simulationlog.route('/link/list', methods=['GET','POST']) 
def view_board_list():
    market_cate = get_openmarket_category()
    category_nav = defaultdict(dict)

    for content in market_cate:
        category_ar = content[2].split('>')
        ar_len = len(category_ar)
        if ar_len == 3:
            category_nav[category_ar[0]][category_ar[1]][category_ar[2]] = content[1]
        else:
            category_nav[category_ar[0]][category_ar[1]][category_ar[2]][category_ar[3]]['leaf'] = content[1]

    #for val in category_nav:
    #    print category_nav[val]

    return render_template('/link/list.html')

def get_openmarket_category():
    category = board_dao.execute('SELECT * \
        FROM TCMPNY_CATE \
        WHERE CMPNY_C = \'EE128\' AND UPDATE_YN = \'Y\' AND ROWNUM < 100').fetchall()
    return category